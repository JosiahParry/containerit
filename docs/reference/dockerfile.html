<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>dockerfile-method — dockerfile • containerit</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
<meta property="og:title" content="dockerfile-method — dockerfile" />

<meta property="og:description" content="Create a Dockerfile based on either a sessionInfo, a workspace or a file." />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">containerit</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/containerit.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/basic.html">Introduction to package `containerit`</a>
    </li>
    <li>
      <a href="../articles/container.html">Using `containerit` Docker image</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/o2r/containerit/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>dockerfile-method</h1>
    <small>Source: <a href='https://github.com/o2r/containerit//blob/master/R/dockerfile.R'><code>R/dockerfile.R</code></a></small>
    </div>

    
    <p>Create a Dockerfile based on either a sessionInfo, a workspace or a file.</p>
    

    <pre class="usage"><span class='fu'>dockerfile</span>(<span class='kw'>from</span> <span class='kw'>=</span> <span class='kw pkg'>utils</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/utils/topics/sessionInfo'>sessionInfo</a></span>(),
  <span class='kw'>image</span> <span class='kw'>=</span> <span class='fu'><a href='getImageForVersion.html'>getImageForVersion</a></span>(<span class='fu'><a href='getRVersionTag.html'>getRVersionTag</a></span>(<span class='no'>from</span>)),
  <span class='kw'>maintainer</span> <span class='kw'>=</span> <span class='fu'>Sys.info</span>()<span class='kw'>[[</span><span class='st'>"user"</span>]], <span class='kw'>save_image</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>env</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>generator</span> <span class='kw'>=</span> <span class='fu'>paste</span>(<span class='st'>"containerit"</span>,
  <span class='kw pkg'>utils</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/utils/topics/packageDescription'>packageVersion</a></span>(<span class='st'>"containerit"</span>))), <span class='kw'>soft</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>offline</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>copy</span> <span class='kw'>=</span> <span class='fl'>NA</span>, <span class='kw'>container_workdir</span> <span class='kw'>=</span> <span class='st'>"/payload/"</span>, <span class='kw'>cmd</span> <span class='kw'>=</span> <span class='fu'><a href='Cmd.html'>Cmd</a></span>(<span class='st'>"R"</span>),
  <span class='kw'>entrypoint</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>add_self</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>vanilla</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>silent</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>predetect</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>versioned_libs</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>versioned_packages</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>filter_baseimage_pkgs</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>from</th>
      <td><p>The source of the information to construct the Dockerfile. Can be a <code>sessionInfo</code> object, a path to a file, or the path to a workspace). If <code>NULL</code> then no automatic derivation of dependencies happens.</p></td>
    </tr>
    <tr>
      <th>image</th>
      <td><p>(<a href='From-class.html'>From</a>-object or character) Specifes the image that shall be used for the Docker container (<code>FROM</code> instruction).
By default, the image is determinded from the given session. Alternatively, use <code><a href='getImageForVersion.html'>getImageForVersion(..)</a></code> to get an existing image for a manually defined version of R, matching the version with tags from the base image rocker/r-ver (see details about the rocker/r-ver at <a href=''https://hub.docker.com/r/rocker/r-ver/''>'https://hub.docker.com/r/rocker/r-ver/'</a>). Or provide a correct image name yourself.</p></td>
    </tr>
    <tr>
      <th>maintainer</th>
      <td><p>Specify the maintainer of the dockerfile. See documentation at <a href=''https://docs.docker.com/engine/reference/builder/#maintainer''>'https://docs.docker.com/engine/reference/builder/#maintainer'</a>. Defaults to <code>Sys.info()[["user"]]</code>. Can be removed with <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>save_image</th>
      <td><p>When TRUE, it calls <a href='http://www.rdocumentation.org/packages/base/topics/save'>save.image</a> and include the resulting .RData in the container's working directory.
 Alternatively, you can pass a list of objects to be saved, which may also include arguments to be passed down to <code>save</code>. E.g. save_image = list("object1", "object2", file = "path/in/wd/filename.RData").
<code>save</code> will be called with default arguments file = ".RData" and envir = .GlobalEnv</p></td>
    </tr>
    <tr>
      <th>env</th>
      <td><p>optionally specify environment variables to be included in the image. See documentation: <a href=''https://docs.docker.com/engine/reference/builder/#env'>'https://docs.docker.com/engine/reference/builder/#env</a></p></td>
    </tr>
    <tr>
      <th>soft</th>
      <td><p>(boolean) Whether to include soft dependencies when system dependencies are installed, default is no.</p></td>
    </tr>
    <tr>
      <th>offline</th>
      <td><p>(boolean) Whether to use an online database to detect system dependencies or use local package information (slower!), default is no.</p></td>
    </tr>
    <tr>
      <th>copy</th>
      <td><p>whether and how a workspace should be copied - values: "script", "script_dir" or a list of relative file paths to be copied, or <code>NA</code> ot disable copying of files</p></td>
    </tr>
    <tr>
      <th>container_workdir</th>
      <td><p>the working directory in the container, defaults to <code>/payload/</code> and must end with <code>/</code>. Can be skipped with value <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>cmd</th>
      <td><p>The CMD statement that should be executed by default when running a parameter. Use cmd_Rscript(path) in order to reference an R script to be executed on startup</p></td>
    </tr>
    <tr>
      <th>entrypoint</th>
      <td><p>the ENTRYPOINT statement for the Dockerfile</p></td>
    </tr>
    <tr>
      <th>add_self</th>
      <td><p>Whether to add the package containerit itself if loaded/attached to the session</p></td>
    </tr>
    <tr>
      <th>vanilla</th>
      <td><p>Whether to use an empty vanilla session when packaging scripts and markdown files (equivalent to <code>R --vanilla</code>)</p></td>
    </tr>
    <tr>
      <th>silent</th>
      <td><p>Whether or not to print information during execution</p></td>
    </tr>
    <tr>
      <th>predetect</th>
      <td><p>Extract the required libraries based on <code>library</code> calls using the package <code>automagic</code> before running a script/document</p></td>
    </tr>
    <tr>
      <th>versioned_libs</th>
      <td><p>[EXPERIMENTAL] Whether it shall be attempted to match versions of linked external libraries</p></td>
    </tr>
    <tr>
      <th>versioned_packages</th>
      <td><p>[EXPERIMENTAL] Whether it shall be attempted to match versions of R packages</p></td>
    </tr>
    <tr>
      <th>filter_baseimage_pkgs</th>
      <td><p>Whether it shall be attempted to match versions of R packages</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class Dockerfile</p>
    
    <h2 class="hasAnchor" id="based-on-sessioninfo"><a class="anchor" href="#based-on-sessioninfo"></a>Based on <code>sessionInfo</code></h2>

    
    <p>Use the current <code><a href='http://www.rdocumentation.org/packages/utils/topics/sessionInfo'>sessionInfo</a>)</code> to create a Dockerfile.</p>
    
    <h2 class="hasAnchor" id="based-on-a-workspace-directory"><a class="anchor" href="#based-on-a-workspace-directory"></a>Based on a workspace/directory</h2>

    
    <p>Given an existing path to a directory, the method tries to automatically find the main <code>R</code> file within that directory.
Files are searched recursively. The following types are supported:</p>
<ol>
<li><p>regular R script files, identified by file names ending in <code>.R</code></p></li>
<li><p>weaved documents, identified by file names ending in <a href='http://rmarkdown.rstudio.com/'>R Markdown</a> (<code>.Rmd</code>)</p></li>
</ol>
    <p>After identifying the main file, the process continues as described in the section file.
If both types are found, documents are given priority over scripts.
If multiple files are found, the first file as returned by <code><a href='http://www.rdocumentation.org/packages/base/topics/list.files'>dir</a></code> will be used.</p>
    
    <h2 class="hasAnchor" id="based-on-a-file"><a class="anchor" href="#based-on-a-file"></a>Based on a file</h2>

    
    <p>Given an executable <code>R</code> script or document, create a Dockerfile to execute this file.
This executes the whole file to obtain a complete <code>sessionInfo</code> object, see section "Based on <code>sessionInfo</code>", and copies required files and documents into the container.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>dockerfile</span> <span class='kw'>&lt;-</span> <span class='fu'>dockerfile</span>()</div><div class='output co'>#&gt; <span class='warning'>Warning: DESCRIPTION file of package 'plm' is missing or broken</span></div><div class='output co'>#&gt; <span class='error'>Error: $ operator is invalid for atomic vectors</span></div><div class='input'><span class='fu'>print</span>(<span class='no'>dockerfile</span>)</div><div class='output co'>#&gt; function(from = utils::sessionInfo(),
#&gt;                        image = getImageForVersion(getRVersionTag(from)),
#&gt;                        maintainer = Sys.info()[["user"]],
#&gt;                        save_image = FALSE,
#&gt;                        env = list(generator = paste("containerit", utils::packageVersion("containerit"))),
#&gt;                        soft = FALSE,
#&gt;                        offline = FALSE,
#&gt;                        copy = NA, # "script",
#&gt;                        # nolint start
#&gt;                        container_workdir = "/payload/",
#&gt;                        # nolint end
#&gt;                        cmd = Cmd("R"),
#&gt;                        entrypoint = NULL,
#&gt;                        add_self = FALSE,
#&gt;                        vanilla = TRUE,
#&gt;                        silent = FALSE,
#&gt;                        predetect = TRUE,
#&gt;                        versioned_libs = FALSE,
#&gt;                        versioned_packages = FALSE,
#&gt;                        filter_baseimage_pkgs = FALSE) {
#&gt;     if (silent) {
#&gt;       invisible(futile.logger::flog.threshold(futile.logger::WARN))
#&gt;     }
#&gt; 
#&gt;     .dockerfile &lt;- NA
#&gt;     .originalFrom &lt;- class(from)
#&gt; 
#&gt;     #parse From-object from string if necessary
#&gt;     if (is.character(image)) {
#&gt;       image &lt;- parseFrom(image)
#&gt;     }
#&gt;     futile.logger::flog.debug("Creating a new Dockerfile from '%s' with base image %s", from, toString(image))
#&gt; 
#&gt;     if (is.character(maintainer)) {
#&gt;       .label &lt;- Label_Maintainer(maintainer)
#&gt;       futile.logger::flog.debug("Turning maintainer character string '%s' into label: %s", maintainer, toString(.label))
#&gt;       maintainer &lt;- .label
#&gt;     }
#&gt; 
#&gt;     # check CMD instruction
#&gt;     if (!inherits(x = cmd, "Cmd")) {
#&gt;       stop("Unsupported parameter for 'cmd', expected an object of class 'Cmd', given was :",
#&gt;         class(cmd))
#&gt;     }
#&gt; 
#&gt;     # check ENTRYPOINT instruction
#&gt;     if ( !is.null(entrypoint) &amp;&amp; !inherits(x = entrypoint, "Entrypoint")) {
#&gt;       stop("Unsupported parameter for 'entrypoint', expected an object of class 'Entrypoint', given was :",
#&gt;         class(entrypoint))
#&gt;     }
#&gt; 
#&gt;     # check and create WORKDIR instruction
#&gt;     workdir &lt;- NULL
#&gt;     if ( !is.null(container_workdir)) {
#&gt;       if ( !is.character(container_workdir)) {
#&gt;         stop("Unsupported parameter for 'container_workdir', expected a character string or NULL")
#&gt;       } else {
#&gt;         # nolint start
#&gt;         if (!stringr::str_detect(container_workdir, "/$")) {
#&gt;           # nolint end
#&gt;           # directories given as destination must have a trailing slash in dockerfiles
#&gt;           container_workdir &lt;- paste0(container_workdir, "/")
#&gt;           futile.logger::flog.info("Appended trailing slash, workdir is '%s'", container_workdir)
#&gt;         }
#&gt;         workdir &lt;- Workdir(container_workdir)
#&gt;       }
#&gt;     }
#&gt; 
#&gt;     # whether image is supported
#&gt;     image_name &lt;- image@image
#&gt;     if (!image_name %in% .supported_images) {
#&gt;       warning("Unsupported base image. Proceed at your own risk. The following base images are supported:\n",
#&gt;         paste(.supported_images, collapse = "\n"))
#&gt;     }
#&gt; 
#&gt;     # base dockerfile
#&gt;     .dockerfile &lt;- methods::new("Dockerfile",
#&gt;                                 instructions = list(),
#&gt;                                 maintainer = maintainer,
#&gt;                                 image = image,
#&gt;                                 entrypoint = entrypoint,
#&gt;                                 cmd = cmd)
#&gt; 
#&gt;     # handle differe "from" cases
#&gt;     if (is.null(from)) {
#&gt;       futile.logger::flog.debug("from is NULL, not deriving any information at all")
#&gt;       if (!is.null(workdir))
#&gt;         addInstruction(.dockerfile) &lt;- workdir
#&gt;     } else if (inherits(x = from, "sessionInfo")) {
#&gt;       futile.logger::flog.debug("Creating from sessionInfo object")
#&gt;       .dockerfile &lt;- dockerfileFromSession(.dockerfile = .dockerfile,
#&gt;                                            session = from,
#&gt;                                            soft = soft,
#&gt;                                            offline = offline,
#&gt;                                            add_self = add_self,
#&gt;                                            versioned_libs = versioned_libs,
#&gt;                                            versioned_packages = versioned_packages,
#&gt;                                            filter_baseimage_pkgs = filter_baseimage_pkgs,
#&gt;                                            workdir = workdir)
#&gt;     } else if (inherits(x = from, "character")) {
#&gt;       futile.logger::flog.debug("Creating from character string '%s'", from)
#&gt; 
#&gt;       if (dir.exists(from)) {
#&gt;         futile.logger::flog.debug("'%s' is a directory", from)
#&gt;         .originalFrom &lt;- from
#&gt;         .dockerfile &lt;- dockerfileFromWorkspace(path = from,
#&gt;                                                .dockerfile = .dockerfile,
#&gt;                                                soft = soft,
#&gt;                                                offline = offline,
#&gt;                                                add_self = add_self,
#&gt;                                                copy = copy,
#&gt;                                                vanilla = vanilla,
#&gt;                                                silent = silent,
#&gt;                                                predetect = predetect,
#&gt;                                                versioned_libs = versioned_libs,
#&gt;                                                versioned_packages = versioned_packages,
#&gt;                                                filter_baseimage_pkgs = filter_baseimage_pkgs,
#&gt;                                                workdir = workdir)
#&gt;       } else if (file.exists(from)) {
#&gt;         futile.logger::flog.debug("'%s' is a file", from)
#&gt;         .originalFrom &lt;- from
#&gt;         .dockerfile &lt;- dockerfileFromFile(file = from,
#&gt;                                           .dockerfile = .dockerfile,
#&gt;                                           soft = soft,
#&gt;                                           offline = offline,
#&gt;                                           add_self = add_self,
#&gt;                                           copy = copy,
#&gt;                                           vanilla = vanilla,
#&gt;                                           silent = silent,
#&gt;                                           predetect = predetect,
#&gt;                                           versioned_libs = versioned_libs,
#&gt;                                           versioned_packages = versioned_packages,
#&gt;                                           filter_baseimage_pkgs = filter_baseimage_pkgs,
#&gt;                                           workdir = workdir)
#&gt;       } else {
#&gt;         stop("Unsupported string for 'from' argument (not a file, not a directory): ", from)
#&gt;       }
#&gt;     } else if (is.expression(from) ||
#&gt;                (is.list(from) &amp;&amp; all(sapply(from, is.expression)))) {
#&gt;       futile.logger::flog.debug("Creating from expession: '%s' with a clean session", toString(from))
#&gt; 
#&gt;       .sessionInfo &lt;- clean_session(expr = from,
#&gt;                                     slave = silent,
#&gt;                                     vanilla = vanilla)
#&gt;       .dockerfile &lt;- dockerfileFromSession(.dockerfile = .dockerfile,
#&gt;                                            session = .sessionInfo,
#&gt;                                            soft = soft,
#&gt;                                            offline = offline,
#&gt;                                            add_self = add_self,
#&gt;                                            versioned_libs = versioned_libs,
#&gt;                                            versioned_packages = versioned_packages,
#&gt;                                            filter_baseimage_pkgs = filter_baseimage_pkgs,
#&gt;                                            workdir = workdir)
#&gt;     } else {
#&gt;       stop("Unsupported 'from': ", class(from), " ", from)
#&gt;     }
#&gt; 
#&gt;     # copy any additional files / objects into the working directory from here:
#&gt;     if (isTRUE(save_image)) {
#&gt;       save.image()
#&gt;       addInstruction(.dockerfile) &lt;-
#&gt;         Copy(src = "./.RData", dest = "./")
#&gt;     } else if (is.list(save_image)) {
#&gt;       do.call(.save_objects, save_image)
#&gt;       if ("file" %in% names(save_image)) {
#&gt;         file &lt;- save_image$file
#&gt;         # try to assure unix-compatibility..
#&gt;         file &lt;- stringr::str_replace_all(file, "\\\\", "/")
#&gt;       } else
#&gt;         file = "./payload.RData"
#&gt;       addInstruction(.dockerfile) &lt;- Copy(src = file, dest = file)
#&gt;     }
#&gt; 
#&gt;     futile.logger::flog.info("Created Dockerfile-Object based on %s", .originalFrom)
#&gt;     return(.dockerfile)
#&gt;   }
#&gt; &lt;environment: namespace:containerit&gt;</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#based-on-sessioninfo">Based on <code>sessionInfo</code></a></li>

      <li><a href="#based-on-a-workspace-directory">Based on a workspace/directory</a></li>

      <li><a href="#based-on-a-file">Based on a file</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Daniel Nuest, Matthias Hinz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>


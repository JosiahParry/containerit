<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using <code>containerit</code> Docker image • containerit</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Using &lt;code&gt;containerit&lt;/code&gt; Docker image">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">containerit</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/containerit.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basic.html">Introduction to package `containerit`</a>
    </li>
    <li>
      <a href="../articles/container.html">Using `containerit` Docker image</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/o2r/containerit/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Using <code>containerit</code> Docker image</h1>
                        <h4 class="author">Daniel Nüst</h4>
            
            <h4 class="date">2018-03-26</h4>
      
      <small>Source: <a href="https://github.com/o2r/containerit//blob/master/vignettes/container.Rmd"><code>vignettes/container.Rmd</code></a></small>

    </div>

    
    
<div class="contents">
<!-- Copyright 2018 Opening Reproducible Research (https://o2r.info) -->
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Containerit is also available itself as a ready-to-use Docker image. This is useful if you do not want to install a full stack of packages in your local machine, but still trace a specific R session/script/document.</p>
</div>
<div id="tldr---pull-image-and-show-dockerfile-on-console" class="section level2">
<h2 class="hasAnchor">
<a href="#tldr---pull-image-and-show-dockerfile-on-console" class="anchor"></a>tl;dr - pull image and show Dockerfile on console</h2>
<p>The following example pulls the <code>geospatial</code> variant of the containerit images and prints out the created Dockerfile to the console.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ex">docker</span> run --rm o2rproject/containerit:geospatial R -e <span class="st">"df &lt;- dockerfile(); print(df);"</span></a></code></pre></div>
<pre><code>## 
## R version 3.4.3 (2017-11-30) -- "Kite-Eating Tree"
## Copyright (C) 2017 The R Foundation for Statistical Computing
## Platform: x86_64-pc-linux-gnu (64-bit)
## 
## R is free software and comes with ABSOLUTELY NO WARRANTY.
## You are welcome to redistribute it under certain conditions.
## Type 'license()' or 'licence()' for distribution details.
## 
## R is a collaborative project with many contributors.
## Type 'contributors()' for more information and
## 'citation()' on how to cite R or R packages in publications.
## 
## Type 'demo()' for some demos, 'help()' for on-line help, or
## 'help.start()' for an HTML browser interface to help.
## Type 'q()' to quit R.
## 
## &gt; df &lt;- dockerfile(); print(df);
## INFO [2018-03-26 20:22:40] Going online? TRUE  ... to retrieve system dependencies (sysreq-api)
## INFO [2018-03-26 20:22:40] Trying to determine system requirements for the package(s) 'futile.logger, lambda.r, Rcpp, futile.options, semver' from sysreq online DB
## INFO [2018-03-26 20:22:41] Adding CRAN packages: futile.logger, futile.options, lambda.r, Rcpp, semver
## INFO [2018-03-26 20:22:41] Created Dockerfile-Object based on sessionInfo
## FROM rocker/r-ver:3.4.3
## LABEL maintainer="root"
## RUN export DEBIAN_FRONTEND=noninteractive; apt-get -y update \
##  &amp;&amp; apt-get install -y NULL
## RUN ["install2.r", "futile.logger", "futile.options", "lambda.r", "Rcpp", "semver"]
## WORKDIR /payload/
## CMD ["R"]
## &gt; 
## &gt; 
## 
## R version 3.4.3 (2017-11-30)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Debian GNU/Linux 9 (stretch)
## 
## Matrix products: default
## BLAS: /usr/lib/openblas-base/libblas.so.3
## LAPACK: /usr/lib/libopenblasp-r0.2.19.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] containerit_0.2.4   futile.logger_1.4.3
## 
## loaded via a namespace (and not attached):
##  [1] compiler_3.4.3       rjson_0.2.15         magrittr_1.5        
##  [4] tools_3.4.3          lambda.r_1.2         Rcpp_0.12.15        
##  [7] futile.options_1.0.0 stringi_1.1.6        stringr_1.3.0       
## [10] semver_0.2.0        
## 
##                                             CRAN 
## "https://mran.microsoft.com/snapshot/2018-02-28"</code></pre>
</div>
<div id="control-output" class="section level2">
<h2 class="hasAnchor">
<a href="#control-output" class="anchor"></a>Control output</h2>
<p>By default the containerit images print the session info before R is terminated. You can disable this by setting the environment variable <code>CONTAINERIT_SILENT</code>. Combined with the <code>--quiet</code> option for R, this reduces the output to merely the Dockerfile</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="ex">docker</span> run --rm -e CONTAINERIT_SILENT=true o2rproject/containerit:geospatial R -q -e <span class="st">"df &lt;- dockerfile(); print(df);"</span></a></code></pre></div>
<pre><code>## &gt; df &lt;- dockerfile(); print(df);
## INFO [2018-03-26 20:22:44] Going online? TRUE  ... to retrieve system dependencies (sysreq-api)
## INFO [2018-03-26 20:22:44] Trying to determine system requirements for the package(s) 'futile.logger, lambda.r, Rcpp, futile.options, semver' from sysreq online DB
## INFO [2018-03-26 20:22:45] Adding CRAN packages: futile.logger, futile.options, lambda.r, Rcpp, semver
## INFO [2018-03-26 20:22:45] Created Dockerfile-Object based on sessionInfo
## FROM rocker/r-ver:3.4.3
## LABEL maintainer="root"
## RUN export DEBIAN_FRONTEND=noninteractive; apt-get -y update \
##  &amp;&amp; apt-get install -y NULL
## RUN ["install2.r", "futile.logger", "futile.options", "lambda.r", "Rcpp", "semver"]
## WORKDIR /payload/
## CMD ["R"]
## &gt; 
## &gt;</code></pre>
<p>You can set the <a href="https://github.com/zatonovo/futile.logger#thresholds">futile.logger threshold</a> with the environment variable <code>CONTAINERIT_FLOG_THRESHOLD</code> to <code>ERROR</code>, <code>WARN</code> or <code>DEBUG</code>; default is <code>INFO</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="ex">docker</span> run --rm -e CONTAINERIT_SILENT=true -e CONTAINERIT_FLOG_THRESHOLD=WARN o2rproject/containerit:geospatial R -q -e <span class="st">"df &lt;- dockerfile(); print(df);"</span></a></code></pre></div>
<pre><code>## &gt; df &lt;- dockerfile(); print(df);
## FROM rocker/r-ver:3.4.3
## LABEL maintainer="root"
## RUN export DEBIAN_FRONTEND=noninteractive; apt-get -y update \
##  &amp;&amp; apt-get install -y NULL
## RUN ["install2.r", "futile.logger", "futile.options", "lambda.r", "Rcpp", "semver"]
## WORKDIR /payload/
## CMD ["R"]
## &gt; 
## &gt;</code></pre>
</div>
<div id="save-file" class="section level2">
<h2 class="hasAnchor">
<a href="#save-file" class="anchor"></a>Save file</h2>
<p>You can of course also mount a directory with write permissions and save the Dockerfile. The default directory in the container is <code>/containerit</code>, so you can mount to this location and write the Dockerfile object:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="fu">mkdir</span> /tmp/containerit</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="ex">docker</span> run --rm -v /tmp/containerit:/containerit -e CONTAINERIT_SILENT=true -e CONTAINERIT_FLOG_THRESHOLD=WARN o2rproject/containerit:geospatial R -q -e <span class="st">"df &lt;- dockerfile(); write(df);"</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="bu">echo</span> Directory contents:</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="fu">ls</span> -l /tmp/containerit</a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="fu">rm</span> -r /tmp/containerit</a></code></pre></div>
<pre><code>## &gt; df &lt;- dockerfile(); write(df);
## INFO [2018-03-26 20:22:53] Writing dockerfile to /containerit/Dockerfile
## &gt; 
## &gt; 
## Directory contents:
## total 4
## -rw-r--r-- 1 root root 251 Mar 26 22:22 Dockerfile</code></pre>
<p>Or you can use full paths, as shown below. The next example also sets the <a href="https://github.com/rocker-org/rocker/wiki/managing-users-in-docker">user of the container</a>, so that the file on the host has a more convenient user and permissions.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="fu">mkdir</span> /tmp/containerit</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="ex">docker</span> run --rm -v /tmp/containerit:/my_dir -e CONTAINERIT_SILENT=true -e CONTAINERIT_FLOG_THRESHOLD=WARN --user=1000 o2rproject/containerit:geospatial R -q -e <span class="st">"df &lt;- dockerfile(); write(df, file = '/my_dir/Dockerfile');"</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="bu">echo</span> Directory contents:</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="fu">ls</span> -l /tmp/containerit</a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="fu">rm</span> -r /tmp/containerit</a></code></pre></div>
<pre><code>## &gt; df &lt;- dockerfile(); write(df, file = '/my_dir/Dockerfile');
## INFO [2018-03-26 20:22:57] Writing dockerfile to /my_dir/Dockerfile
## &gt; 
## &gt; 
## Directory contents:
## total 4
## -rw-r--r-- 1 daniel daniel 254 Mar 26 22:22 Dockerfile</code></pre>
</div>
<div id="example-package-script" class="section level2">
<h2 class="hasAnchor">
<a href="#example-package-script" class="anchor"></a>Example: package script</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="fu">mkdir</span> /tmp/containerit</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="bu">echo</span> <span class="st">"install.packages('fortunes', repos = 'http://cran.r-project.org'); fortunes::fortune();"</span> <span class="op">&gt;&gt;</span> /tmp/containerit/script.R</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="ex">docker</span> run --rm -v /tmp/containerit:/data o2rproject/containerit R -q -e <span class="st">"setwd('/data'); scriptFile &lt;- 'script.R'; write(dockerfile(from = scriptFile, cmd = CMD_Rscript(basename(scriptFile))));"</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="fu">cat</span> /tmp/containerit/Dockerfile</a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="fu">rm</span> -r /tmp/containerit</a></code></pre></div>
<pre><code>## &gt; setwd('/data'); scriptFile &lt;- 'script.R'; write(dockerfile(from = scriptFile, cmd = CMD_Rscript(basename(scriptFile))));
## INFO [2018-03-26 20:23:00] Executing R script file in script.R locally.
## INFO [2018-03-26 20:23:00] Creating an R session with the following arguments:
##   R  --silent --vanilla -e "source(file = \"/data/script.R\", echo = TRUE)" -e "info &lt;- sessionInfo()" -e "save(list = \"info\", file = \"/tmp/Rtmp3GoEsu/rdata-sessioninfo1756b5f00\")"
## &gt; source(file = "/data/script.R", echo = TRUE)
## 
## &gt; install.packages("fortunes", repos = "http://cran.r-project.org")
## Installing package into ‘/usr/local/lib/R/site-library’
## (as ‘lib’ is unspecified)
## trying URL 'http://cran.r-project.org/src/contrib/fortunes_1.5-4.tar.gz'
## Content type 'application/x-gzip' length 192938 bytes (188 KB)
## ==================================================
## downloaded 188 KB
## 
## * installing *source* package ‘fortunes’ ...
## ** package ‘fortunes’ successfully unpacked and MD5 sums checked
## ** R
## ** inst
## ** preparing package for lazy loading
## ** help
## *** installing help indices
## ** building package indices
## ** installing vignettes
## ** testing if installed package can be loaded
## * DONE (fortunes)
## 
## The downloaded source packages are in
##  ‘/tmp/Rtmpfq43nC/downloaded_packages’
## 
## &gt; fortunes::fortune()
## 
## It was simple, but you know, it's always simple when you've done it.
##    -- Simone Gabbriellini (after solving a problem with a trick suggested on
##       the list)
##       R-help (August 2005)
## 
## &gt; info &lt;- sessionInfo()
## &gt; save(list = "info", file = "/tmp/Rtmp3GoEsu/rdata-sessioninfo1756b5f00")
## &gt; 
## &gt; 
## INFO [2018-03-26 20:23:03] Going online? TRUE  ... to retrieve system dependencies (sysreq-api)
## INFO [2018-03-26 20:23:03] Trying to determine system requirements for the package(s) 'fortunes' from sysreq online DB
## INFO [2018-03-26 20:23:04] Adding CRAN packages: fortunes
## INFO [2018-03-26 20:23:04] Created Dockerfile-Object based on script.R
## INFO [2018-03-26 20:23:04] Writing dockerfile to /data/Dockerfile
## Warning message:
## In getImageForVersion(r_version) :
##   No Docker image found for the given R version. You might want to specify a custom Docker image or 
##   use one of the following supported version tags (maybe check the internet connection if no suggestions appear). 
##  devel latest 3.4.4 3.4.1 3.3.1 3.2.0 3.3.2 3.1 3.1.0 3.3.0
## &gt; 
## &gt; 
## 
## R version 3.4.2 (2017-09-28)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Debian GNU/Linux 9 (stretch)
## 
## Matrix products: default
## BLAS/LAPACK: /usr/lib/libopenblasp-r0.2.19.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] containerit_0.2.3   futile.logger_1.4.3
## 
## loaded via a namespace (and not attached):
## [1] compiler_3.4.2       rjson_0.2.15         magrittr_1.5        
## [4] tools_3.4.2          lambda.r_1.2         futile.options_1.0.0
## [7] stringi_1.1.5        stringr_1.2.0       
## 
##                                             CRAN 
## "https://mran.microsoft.com/snapshot/2017-10-31" 
## FROM rocker/r-ver:3.4.2
## LABEL maintainer="rstudio"
## RUN ["install2.r", "fortunes"]
## WORKDIR /payload/
## COPY ["script.R", "script.R"]
## CMD ["R", "--vanilla", "-f", "script.R"]</code></pre>
</div>
<div id="build-image" class="section level2">
<h2 class="hasAnchor">
<a href="#build-image" class="anchor"></a>Build image</h2>
<p>With the following commands you can build an image from the local source code. The following command executed in the <code>containerit</code> source directory creates an image <code>containerit</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="ex">docker</span> build --file inst/docker/local/Dockerfile --tag containerit .</a></code></pre></div>
<p>You can try the <code>predetect</code> feature by packaging the R Markdown file of the spacetime vignette:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="ex">docker</span> run --rm -it -v <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>/tests/testthat/package_markdown/spacetime:/erc -e CONTAINERIT_FLOG_THRESHOLD=DEBUG containerit R -e <span class="st">"setwd('/erc'); print(dockerfile(from = '/erc'))"</span></a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#tldr---pull-image-and-show-dockerfile-on-console">tl;dr - pull image and show Dockerfile on console</a></li>
      <li><a href="#control-output">Control output</a></li>
      <li><a href="#save-file">Save file</a></li>
      <li><a href="#example-package-script">Example: package script</a></li>
      <li><a href="#build-image">Build image</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Daniel Nuest, Matthias Hinz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
